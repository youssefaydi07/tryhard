<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Chronomètre Professionnel</title>

    <style>
        :root {
            --bg: #0d0d0d;
            --fg: #eaeaea;
            --panel: #111;
            --btn-bg: #1c1c1c;
            --radius: 16px;
        }

        body.light {
            --bg: #f4f4f4;
            --fg: #121212;
            --panel: #ffffff;
            --btn-bg: #ececec;
        }

        body {
            background-color: var(--bg);
            color: var(--fg);
            font-family: "Inter", sans-serif;
            text-align: center;
            padding-top: 60px;
            transition: 0.3s ease;
            user-select: none;
        }

        h1 {
            font-weight: 300;
            font-size: 28px;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        #chrono {
            font-size: 72px;
            font-family: "JetBrains Mono", monospace;
            background: var(--panel);
            padding: 25px 50px;
            border-radius: var(--radius);
            display: inline-block;
            margin-bottom: 30px;
            box-shadow: 0 0 60px rgba(255,255,255,0.06);
            transition: transform 0.08s ease, text-shadow 0.3s ease;
        }

        button {
            font-size: 17px;
            padding: 12px 30px;
            margin: 8px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            background: var(--btn-bg);
            color: var(--fg);
            letter-spacing: 0.5px;
            transition: 0.25s;
        }

        button:hover { transform: scale(1.08); filter: brightness(1.2); }
        button:active { transform: scale(0.95); }

        #btnStart { background-color: #27ae60; }
        #btnStop { background-color: #c0392b; }
        #btnReset { background-color: #7f8c8d; }
        #btnFull { background-color: #f39c12; }
        #btnTheme { background-color: #8e44ad; }
        #btnAddTime { background-color: #2980b9; }
        #btnRemoveTime { background-color: #d35400; }

        #panel {
            margin-top: 40px;
            background: var(--panel);
            padding: 25px;
            border-radius: 14px;
            width: 400px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 0 30px rgba(255,255,255,0.04);
        }

        #panel input {
            width: 70px;
            padding: 8px;
            font-size: 16px;
            text-align: center;
            border-radius: 8px;
            background: var(--btn-bg);
            border: 1px solid #333;
            color: var(--fg);
            margin: 5px;
        }

        .minimal h1,
        .minimal .buttons,
        .minimal #panel {
            display: none;
        }
    </style>
</head>

<body>

    <h1>Chronomètre Professionnel</h1>

    <div id="chrono">00:00:00.00</div>

    <div class="buttons">
        <button id="btnStart">Démarrer</button>
        <button id="btnStop">Arrêter</button>
        <button id="btnReset">Reset</button>
        <button id="btnFull">Plein écran</button>
        <button id="btnTheme">Clair / Sombre</button>
    </div>

    <div id="panel">
        <label><b>Ajouter / Enlever du temps :</b></label><br><br>

        <input id="h" type="number" min="0" placeholder="Heures">
        <input id="m" type="number" min="0" max="59" placeholder="Minutes">
        <input id="s" type="number" min="0" max="59" placeholder="Secondes">
        <br>
        <input id="totalSec" type="number" min="0" placeholder="Sec totales">

        <br><br>

        <button id="btnAddTime">Ajouter</button>
        <button id="btnRemoveTime">Enlever</button>
    </div>

    <audio id="startSound">
        <source src="data:audio/mp3;base64,//uQZAAA..." type="audio/mp3">
    </audio>

    <script>
        const chronoEl = document.getElementById("chrono");
        const startSound = document.getElementById("startSound");

        const state = {
            depart: null,
            pauseTemps: 0,
            enCours: false,
            rafID: null
        };

        function saveState() {
            localStorage.setItem("chronoState", JSON.stringify(state));
        }

        function loadState() {
            let s = JSON.parse(localStorage.getItem("chronoState"));
            if (!s) return;

            state.depart     = s.depart;
            state.pauseTemps = s.pauseTemps;
            state.enCours    = s.enCours;

            if (state.enCours) {
                state.rafID = requestAnimationFrame(maj);
            } else {
                afficher(state.pauseTemps);
            }
        }

        function formatTime(ms) {
            let h = Math.floor(ms / 3600000);
            let m = Math.floor((ms / 60000) % 60);
            let s = Math.floor((ms / 1000) % 60);
            let c = Math.floor((ms % 1000) / 10);

            return `${String(h).padStart(2,'0')}:` +
                   `${String(m).padStart(2,'0')}:` +
                   `${String(s).padStart(2,'0')}.` +
                   `${String(c).padStart(2,'0')}`;
        }

        function afficher(ms) {
            chronoEl.textContent = formatTime(ms);

            chronoEl.style.textShadow = "0 0 18px rgba(255,255,255,0.20)";
            chronoEl.style.transform = "scale(1.04)";

            setTimeout(() => {
                chronoEl.style.textShadow = "0 0 0 rgba(0,0,0,0)";
                chronoEl.style.transform = "scale(1)";
            }, 90);
        }

        function maj() {
            if (!state.enCours) return;
            let now = Date.now();
            let ecoule = now - state.depart + state.pauseTemps;
            afficher(ecoule);
            state.rafID = requestAnimationFrame(maj);
        }

        // ------------------------------
        // FONCTION : CALCUL TOTAL TEMPS
        // ------------------------------

        function getTotalMillis() {
            let h = parseInt(document.getElementById("h").value) || 0;
            let m = parseInt(document.getElementById("m").value) || 0;
            let s = parseInt(document.getElementById("s").value) || 0;
            let t = parseInt(document.getElementById("totalSec").value) || 0;

            return h * 3600000 + m * 60000 + s * 1000 + t * 1000;
        }

        // ------------------------------
        // DÉMARRER
        // ------------------------------

        document.getElementById("btnStart").onclick = () => {
            if (!state.enCours) {
                state.enCours = true;
                state.depart = Date.now();
                saveState();
                startSound.play();
                if (navigator.vibrate) navigator.vibrate(100);
                state.rafID = requestAnimationFrame(maj);
            }
        };

        // ------------------------------
        // ARRÊTER
        // ------------------------------

        document.getElementById("btnStop").onclick = () => {
            if (state.enCours) {
                state.enCours = false;
                state.pauseTemps += Date.now() - state.depart;
                if (navigator.vibrate) navigator.vibrate([80,40,80]);
                saveState();
                cancelAnimationFrame(state.rafID);
            }
        };

        // ------------------------------
        // RESET
        // ------------------------------

        document.getElementById("btnReset").onclick = () => {
            state.enCours = false;
            cancelAnimationFrame(state.rafID);
            state.pauseTemps = 0;
            state.depart = null;
            if (navigator.vibrate) navigator.vibrate(200);
            saveState();
            afficher(0);
        };

        // ------------------------------
        // AJOUTER TEMPS
        // ------------------------------

        document.getElementById("btnAddTime").onclick = () => {
            let ajout = getTotalMillis();

            state.pauseTemps += ajout;

            if (state.enCours) state.depart = Date.now();
            saveState();
            afficher(state.pauseTemps);
        };

        // ------------------------------
        // ENLEVER TEMPS
        // ------------------------------

        document.getElementById("btnRemoveTime").onclick = () => {
            let retirer = getTotalMillis();
            let tempsActuel = (state.enCours ? (Date.now() - state.depart) : 0) + state.pauseTemps;

            if (retirer > tempsActuel) {
                state.pauseTemps = 0;
                if (state.enCours) state.depart = Date.now();
            } else {
                state.pauseTemps -= retirer;
                if (state.enCours) state.depart = Date.now();
            }

            saveState();
            afficher(state.pauseTemps);
        };

        // ------------------------------
        // THÈME
        // ------------------------------

        document.getElementById("btnTheme").onclick = () =>
            document.body.classList.toggle("light");

        // ------------------------------
        // PLEIN ÉCRAN
        // ------------------------------

        document.getElementById("btnFull").onclick = () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        };

        // ------------------------------
        // MODE MINIMAL (M)
        // ------------------------------

        document.addEventListener("keydown", e => {
            if (e.key.toLowerCase() === "m") {
                document.body.classList.toggle("minimal");
            }
        });

        loadState();
    </script>

</body>
</html>
